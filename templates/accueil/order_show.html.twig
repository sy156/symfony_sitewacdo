{% extends 'base.html.twig' %}

{% block title %}
	Commande #{{ order.id }}
{% endblock %}

{% block body %}
	<div
		class="container mt-5">

		{# Boutons en haut #}
		<div class="mb-3 d-flex gap-2">
			<a href="{{ path('accueil_dashboard') }}" class="btn btn-secondary">
				<i class="bi bi-arrow-left-circle"></i>
				Retour au tableau de bord
			</a>
		</div>

		<div class="card mb-4 shadow">
			<div class="card-header fw-bold d-flex justify-content-between align-items-center">
				Commande #{{ order.id }}

				{# Formulaire "Remettre au client" #}
				<form method="post" action="{{ path('accueil_order_deliver', {'id': order.id}) }}">
					<input type="hidden" name="_token" value="{{ csrf_token('deliver' ~ order.id) }}">
					<button class="btn btn-success btn-sm">
						<i class="bi bi-check-circle"></i>
						Remettre au client
					</button>
				</form>
			</div>

			<div
				class="card-body">

				{# Articles dans la commande #}
				<h6>Articles dans la commande :</h6>
				<ul class="list-group mb-3">
					{% for item in order.items %}
						<li class="list-group-item d-flex justify-content-between align-items-center">
							<div>
								<strong>{{ item.product.name }}</strong>
								<span class="text-muted">x{{ item.quantity }}</span>
								<span class="badge bg-primary">{{ item.unitPrice|number_format(2, ',', ' ') }}
									€</span>
							</div>

							{# Formulaire "Supprimer un article" #}
							<form method="post" action="{{ path('accueil_order_remove_item', {'orderId': order.id, 'itemId': item.id}) }}" onsubmit="return confirm('Supprimer cet article ?');">
								<input type="hidden" name="_token" value="{{ csrf_token('remove_item' ~ item.id) }}">
								<button class="btn btn-danger btn-sm">
									<i class="bi bi-trash"></i>
								</button>
							</form>
						</li>
					{% else %}
						<li class="list-group-item text-muted">Aucun produit ajouté.</li>
					{% endfor %}
				</ul>

				<div class="text-end mb-4">
					<h4>Total :
						<span class="badge bg-dark fs-5">{{ order.total|number_format(2, ',', ' ') }}
							€</span>
					</h4>
				</div>

				{# Produits disponibles à ajouter #}
				<h6 class="mt-4">Ajouter un produit :</h6>
				<div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3 mt-2">
					{% for product in products %}
						<div class="col">
							<div class="card h-100 shadow-sm">
								<div class="card-body p-2 d-flex flex-column">
									<h6 class="card-title mb-1">{{ product.name }}</h6>
									<p class="mb-2 text-muted">{{ product.price|number_format(2, ',', ' ') }}
										€</p>

									{# Formulaire "Ajouter un produit" #}
									<form method="post" action="{{ path('accueil_order_add_item', {'orderId': order.id, 'productId': product.id}) }}">
										<input type="hidden" name="_token" value="{{ csrf_token('add_item' ~ order.id) }}">
										<button class="btn btn-sm btn-primary mt-auto">
											<i class="bi bi-plus-circle"></i>
											Ajouter
										</button>
									</form>

								</div>
							</div>
						</div>
					{% endfor %}
				</div>

			</div>
		</div>
	</div>
{% endblock %}
